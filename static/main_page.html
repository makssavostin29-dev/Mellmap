<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MellMap</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      transition: background-color 0.3s, color 0.3s;
      overflow: hidden;
      position: relative;
    }

    :root {
      --bg-color: #ffffff;
      --text-color: #000000;
      --card-bg: #f9f9f9;
      --btn-primary-bg: #FF6B35;
      --btn-primary-hover: #e05a2a;
      --border-color: #eee;
    }

    .dark-theme {
      --bg-color: #121212;
      --text-color: #e0e0e0;
      --card-bg: #1e1e1e;
      --border-color: #333;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    header {
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: var(--bg-color);
      border-bottom: 1px solid(var(--border-color));
      z-index: 10;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 700;
      color: #FF6B35;
      text-decoration: none;
    }

    .theme-toggle {
      background: none;
      border: 1px solid(var(--border-color));
      width: 44px;
      height: 24px;
      border-radius: 12px;
      position: relative;
      cursor: pointer;
      outline: none;
    }

    .theme-toggle::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #FF6B35;
      top: 1px;
      left: 2px;
      transition: transform 0.3s ease;
    }

    .dark-theme .theme-toggle::before {
      transform: translateX(20px);
      background: #03dac6;
    }

    main {
      flex: 1;
      position: relative;
      padding: 2rem 0;
      overflow: hidden;
    }

    /* –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ ‚Äî –ø—Ä–∏–∂–∞—Ç–∞ –∫ –ª–µ–≤–æ–º—É –∫—Ä–∞—é */
    .left-col {
      position: absolute;
      left: 2rem;
      top: 2rem;
      width: 320px;
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid(var(--border-color));
      overflow-y: auto;
      max-height: calc(100vh - 120px);
    }

    /* –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ ‚Äî –ø—Ä–∏–∂–∞—Ç–∞ –∫ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é */
    .right-col {
      position: absolute;
      right: 2rem;
      top: 2rem;
      width: 280px;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      height: calc(100vh - 120px);
      overflow-y: auto;
    }

    .place-card-fullheight {
      background: var(--card-bg);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      flex: 0 0 auto;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .place-card-fullheight:hover {
      transform: translateY(-3px);
    }

    .card-photo-16-9 {
      height: 120px;
      background-size: cover;
      background-position: center;
    }

    .card-info-full {
      padding: 0.9rem;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .card-info-full h3 {
      font-size: 1.1rem;
      margin-bottom: 0.3rem;
      color: var(--text-color);
    }

    .card-meta-full {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 0.2rem;
    }

    .card-meta-full span {
      font-weight: 600;
      color: #FF6B35;
    }

    /* –¶–ï–ù–¢–†–ê–õ–¨–ù–´–ô –ë–õ–û–ö ‚Äî –°–¢–†–û–ì–û –ü–û –¶–ï–ù–¢–†–£ –≠–ö–†–ê–ù–ê */
    .center-col {
      position: absolute;
      left: 50%;
      top: 2rem;
      transform: translateX(-50%);
      width: 360px;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      z-index: 5;
    }

    .map-button-container {
      display: flex;
      justify-content: center;
    }

    .map-link {
      width: 280px;
      padding: 1.2rem;
      font-size: 1.2rem;
      font-weight: 700;
      color: #fff;
      background-color: #FF6B35;
      border: none;
      border-radius: 30px;
      text-decoration: none;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background-color 0.3s ease;
      box-shadow: 0 6px 12px rgba(255, 107, 53, 0.3);
    }

    .map-link:hover {
      background-color: #e05a2a;
      color: white;
    }

    .quick-search {
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid(var(--border-color));
    }

    .quick-search h3 {
      color: #FF6B35;
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }

    .quick-search label {
      display: block;
      margin-bottom: 0.4rem;
      font-weight: 600;
      font-size: 0.95rem;
    }

    .quick-search select,
    .quick-search input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid(var(--border-color));
      border-radius: 6px;
      background: var(--bg-color);
      color: var(--text-color);
    }

    .find-btn {
      width: 100%;
      padding: 0.8rem;
      font-size: 1rem;
      font-weight: 600;
      color: #fff;
      background-color: #FF6B35;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .find-btn:hover {
      background-color: #e05a2a;
    }

    #result {
      margin-top: 1.5rem;
      display: none;
    }

    #result-name {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    #result-meta {
      font-size: 0.9rem;
      color: #666;
    }

    #result-link {
      display: block;
      width: 100%;
      padding: 0.7rem;
      margin-top: 0.8rem;
      font-size: 0.95rem;
      font-weight: 600;
      color: #fff;
      background-color: #FF6B35;
      text-decoration: none;
      border-radius: 30px;
      text-align: center;
      transition: background-color 0.3s ease;
    }

    #result-link:hover {
      background-color: #e05a2a;
    }

    .left-col h2 {
      font-size: 1.3rem;
      margin-bottom: 0.8rem;
      color: #FF6B35;
    }

    .left-col p {
      margin-bottom: 1rem;
      line-height: 1.6;
      font-size: 0.95rem;
    }

    .steps ol {
      padding-left: 1.2rem;
      margin-bottom: 1rem;
    }

    .steps li {
      margin-bottom: 0.6rem;
      line-height: 1.5;
    }
  </style>
</head>
<body>

  <header>
    <a href="#" class="logo">MellMap</a>
    <button class="theme-toggle" id="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É"></button>
  </header>

  <main>
    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
    <div class="left-col">
      <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MellMap!</h2>
      <p>–≠—Ç–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –∑–∞–≤–µ–¥–µ–Ω–∏–π –ú–æ—Å–∫–≤—ã, –≥–¥–µ –º–æ–∂–Ω–æ –≤–∫—É—Å–Ω–æ –∏ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ –ø–æ–∑–∞–≤—Ç—Ä–∞–∫–∞—Ç—å. –ú—ã —Å–æ–±—Ä–∞–ª–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞ —Å –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–¥–∞—á–∏ –∑–∞–≤—Ç—Ä–∞–∫–æ–≤.</p>

      <h2>–ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ –∑–∞–≤—Ç—Ä–∞–∫–∏?</h2>
      <p>–ó–∞–≤—Ç—Ä–∞–∫ ‚Äî —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π –ø—Ä–∏—ë–º –ø–∏—â–∏. –ù–æ –Ω–∞–π—Ç–∏ –º–µ—Å—Ç–æ, –≥–¥–µ –µ–≥–æ –ø–æ–¥–∞—é—Ç –≤ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è, –±—ã–≤–∞–µ—Ç —Å–ª–æ–∂–Ω–æ. –í MellMap –∫–∞–∂–¥–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ –∏–º–µ–µ—Ç —á—ë—Ç–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é: ¬´–≤–µ—Å—å –¥–µ–Ω—å¬ª, ¬´—Ç–æ–ª—å–∫–æ –ø–æ –≤—ã—Ö–æ–¥–Ω—ã–º¬ª –∏–ª–∏ ¬´–≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è¬ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, 8:00‚Äì11:00).</p>

      <h2>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h2>
      <div class="steps">
        <ol>
          <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–ö–∞—Ä—Ç–∞¬ª</li>
          <li>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω –∏–ª–∏ —Ç–∏–ø –∑–∞–≤–µ–¥–µ–Ω–∏—è</li>
          <li>–û—Ç—Ñ–∏–ª—å—Ç—Ä—É–π—Ç–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≤—Ç—Ä–∞–∫–∞</li>
          <li>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: –º–µ–Ω—é, —Ñ–æ—Ç–æ, –∞–¥—Ä–µ—Å, —Å–∞–π—Ç</li>
        </ol>
      </div>
    </div>

    <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –±–ª–æ–∫ ‚Äî –°–¢–†–û–ì–û –ü–û –¶–ï–ù–¢–†–£ -->
    <div class="center-col">
      <div class="map-button-container">
        <a href="map.html" class="map-link">–ö–∞—Ä—Ç–∞</a>
      </div>

      <div class="quick-search">
        <h3>–ù–∞–π–¥–∏ —Å–≤–æ–π –∑–∞–≤—Ç—Ä–∞–∫</h3>
        <div style="display: grid; gap: 0.8rem; font-size: 0.95rem;">
          <div>
            <label>–û–∫—Ä—É–≥:</label>
            <select id="qs-district">
              <option value="">–õ—é–±–æ–π</option>
              <option value="–¶–ê–û">–¶–ê–û</option>
              <option value="–°–ê–û">–°–ê–û</option>
              <option value="–°–í–ê–û">–°–í–ê–û</option>
              <option value="–í–ê–û">–í–ê–û</option>
              <option value="–Æ–í–ê–û">–Æ–í–ê–û</option>
              <option value="–Æ–ê–û">–Æ–ê–û</option>
              <option value="–Æ–ó–ê–û">–Æ–ó–ê–û</option>
              <option value="–ó–ê–û">–ó–ê–û</option>
              <option value="–°–ó–ê–û">–°–ó–ê–û</option>
              <option value="–ó–µ–ª–ê–û">–ó–µ–ª–ê–û</option>
              <option value="–ù–ê–û">–ù–ê–û</option>
              <option value="–¢–ê–û">–¢–ê–û</option>
            </select>
          </div>

          <div>
            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
            <select id="qs-category">
              <option value="">–õ—é–±–∞—è</option>
              <option value="cafe">–ö–∞—Ñ–µ</option>
              <option value="restaurant">–†–µ—Å—Ç–æ—Ä–∞–Ω</option>
              <option value="bar">–ë–∞—Ä</option>
            </select>
          </div>

          <div>
            <label>–í—Ä–µ–º—è –∑–∞–≤—Ç—Ä–∞–∫–∞:</label>
            <select id="qs-breakfast">
              <option value="">–õ—é–±–æ–µ</option>
              <option value="all_day">–í–µ—Å—å –¥–µ–Ω—å</option>
              <option value="weekends_only">–¢–æ–ª—å–∫–æ –ø–æ –≤—ã—Ö–æ–¥–Ω—ã–º</option>
              <option value="specific_time">–í –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è</option>
            </select>
          </div>

          <div>
            <label>–ú–∞–∫—Å. —á–µ–∫ (‚ÇΩ):</label>
            <input type="number" id="qs-price" placeholder="800">
          </div>

          <div>
            <label>–ú–∏–Ω. —Ä–µ–π—Ç–∏–Ω–≥:</label>
            <input type="number" step="0.1" id="qs-rating" placeholder="4.0" min="0" max="5">
          </div>

          <button id="find-btn" class="find-btn">
            –ù–∞–π—Ç–∏ –∑–∞–≤—Ç—Ä–∞–∫!
          </button>
        </div>

        <div id="result">
          <div id="result-name">...</div>
          <div id="result-meta">...</div>
          <a id="result-link" href="#">–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ</a>
        </div>
      </div>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
    <div class="right-col" id="featured-places">
      <div class="place-card-fullheight" style="display: flex; align-items: center; justify-content: center; padding: 1.5rem; color: #999;">
        <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
      </div>
      <div class="place-card-fullheight" style="display: flex; align-items: center; justify-content: center; padding: 1.5rem; color: #999;">
        <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
      </div>
      <div class="place-card-fullheight" style="display: flex; align-items: center; justify-content: center; padding: 1.5rem; color: #999;">
        <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
      </div>
    </div>
  </main>

  <script>
    // ... (–æ—Å—Ç–∞–≤—å —Ç–æ—Ç –∂–µ JS, —á—Ç–æ –±—ã–ª ‚Äî –æ–Ω —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω)
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
      document.body.classList.add('dark-theme');
    }

    document.getElementById('theme-toggle').addEventListener('click', () => {
      document.body.classList.toggle('dark-theme');
      const isDark = document.body.classList.contains('dark-theme');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    const NO_PHOTO_SVG = 'image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgwIiBoZWlnaHQ9IjEyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIiAvPgogIDx0ZXh0IHg9IjE0MCIgeT0iNjAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOTk5Ij5ObyBQaG90byA8L3RleHQ+Cjwvc3ZnPgo=';

    fetch('/api/places/random?count=3')
      .then(res => res.json())
      .then(places => {
        const container = document.getElementById('featured-places');
        container.innerHTML = '';

        if (!Array.isArray(places) || places.length === 0) {
          container.innerHTML = `
            <div class="place-card-fullheight" style="text-align: center; padding: 1.5rem;">
              <p>–ù–µ—Ç –∑–∞–≤–µ–¥–µ–Ω–∏–π –≤ –±–∞–∑–µ</p>
            </div>
          `;
          return;
        }

        places.forEach(place => {
          let photoUrl = NO_PHOTO_SVG;
          if (Array.isArray(place.photos) && place.photos.length > 0) {
            const first = place.photos[0];
            if (typeof first === 'string' && first.trim() !== '') {
              photoUrl = first;
            }
          }

          const card = document.createElement('div');
          card.className = 'place-card-fullheight';
          card.innerHTML = `
            <div class="card-photo-16-9" style="background-image: url('${photoUrl}');"></div>
            <div class="card-info-full">
              <h3>${place.name}</h3>
              <div class="card-meta-full">
                <span>${place.district}</span> ‚Ä¢ ${place.category}
              </div>
              <div class="card-meta-full">
                ‚≠ê ${place.rating} ‚Ä¢ ${place.price}
              </div>
            </div>
          `;
          card.addEventListener('click', () => {
            window.location.href = `map.html?id=${place.id}`;
          });
          container.appendChild(card);
        });
      })
      .catch(err => {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª—É—á–∞–π–Ω—ã—Ö –º–µ—Å—Ç:', err);
        document.getElementById('featured-places').innerHTML = `
          <div class="place-card-fullheight" style="text-align: center; padding: 1.5rem; color: #f00;">
            –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
          </div>
        `;
      });

    document.getElementById('find-btn').addEventListener('click', async () => {
      const params = new URLSearchParams();
      const district = document.getElementById('qs-district').value;
      const category = document.getElementById('qs-category').value;
      const breakfast = document.getElementById('qs-breakfast').value;
      const price = document.getElementById('qs-price').value;
      const rating = document.getElementById('qs-rating').value;

      if (district) params.append('district', district);
      if (category) params.append('category', category);
      if (breakfast) params.append('breakfast_time', breakfast);
      if (price) params.append('max_price', price);
      if (rating) params.append('min_rating', rating);

      try {
        const res = await fetch(`/api/places/random-match?${params}`);
        if (!res.ok) {
          const error = await res.json().catch(() => ({}));
          throw new Error(error.error || '–ù–µ –Ω–∞–π–¥–µ–Ω–æ');
        }

        const place = await res.json();
        document.getElementById('result-name').textContent = place.name;
        document.getElementById('result-meta').textContent =
          `${place.district} ‚Ä¢ ${place.category} ‚Ä¢ ‚≠ê ${place.rating} ‚Ä¢ ${place.price}`;
        document.getElementById('result-link').href = `map.html?id=${place.id}`;
        document.getElementById('result').style.display = 'block';
      } catch (err) {
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–µ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ üò¢\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏.');
        document.getElementById('result').style.display = 'none';
      }
    });
  </script>
</body>
</html>